kind: pipeline
name: deploy_flask_app
type: docker

steps:
- name: build_and_push
  image: plugins/docker
  when:
    branch:
      - dev
      - 4-create-drone-yml
  settings:
    username:
      from_secret:
        docker_username
    password:
      from_secret:
        docker_password
    repo: scr1pter/devops-challenge
    tags: latest

- name: build
  image: docker/compose
  volumes:
    - name: docker_socket
      path: /var/run/docker.sock
  commands:
    - docker-compose up

volumes:
    - name: docker_socket
      host:
        path: /var/run/docker.sock