kind: pipeline
name: deploy_flask_app
type: docker

steps:
- name: build_and_push
  image: plugins/docker
  when:
    branch:
      - dev
      - 4-create-drone-yml
  settings:
    username:
      from_secret:
        docker_username
    password:
      from_secret:
        docker_password
    repo: scr1pter/devops-challenge
    tags: latest

- name: build
  image: docker/compose
  volumes:
    - name: docker_socket
      path: /var/run/docker.sock
  environment:
    AWS_ACCESS_KEY_ID:
      from_secret: aws_acess_key_id
    AWS_SECRET_ACCESS_KEY:
      from_secret: aws_acess_key
    REGION_NAME:
      from_secret: region_name
  commands:
    - sudo docker-compose up

